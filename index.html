<script>
  const API_BASE = "https://farmtotable-backend.onrender.com/"; // ‚úÖ Change to your Render API URL

  function toggleAdmin() {
    const role = document.getElementById("role").value;
    const emailField = document.getElementById("email");
    if (role === "admin") {
      emailField.value = "admin";
      emailField.disabled = true;
    } else {
      emailField.value = "";
      emailField.disabled = false;
    }
  }

  toggleAdmin(); // Run once during load

  async function login() {
    const role = document.getElementById("role").value;
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    if (!email || !password) {
      alert("Please fill both fields.");
      return;
    }

    try {
      const response = await fetch(`${API_BASE}/login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password, role }),
      });

      const data = await response.json();

      if (data.error) {
        alert("‚ùå Login failed: " + data.error);
      } else {
        alert("‚úÖ Welcome " + data.name + "!");

        // ‚úÖ Redirect based on role
        if (data.role === "admin") {
          window.location.href = "admin.html";
        } else if (data.role === "farmer") {
          window.location.href = "farmer.html";
        } else if (data.role === "buyer") {
          window.location.href = "buyer.html";
        } else {
          alert("Unknown user role.");
        }
      }
    } catch (error) {
      alert("üö´ Error connecting to server: " + error.message);
    }
  }
</script>
